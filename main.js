(()=>{"use strict";function t(t,e,n){n(t),e.remove()}function e(t,e,n,o,r){var c=t.target.closest(".card__like-button");c.classList.toggle("card__like-button_is-active"),c.classList.contains("card__like-button_is-active")?e(o).then((function(t){r.textContent=t.likes.length})):n(o).then((function(t){r.textContent=t.likes.length}))}function n(t,e,n,o,r,c,a,i){var u=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),l=u.querySelector(".card__image"),s=u.querySelector(".like-count");l.src=t.link,l.alt=t.name,u.querySelector(".card__title").textContent=t.name;var d=u.querySelector(".card__delete-button");t.owner._id!==r?d.style.display="none":d.addEventListener("click",(function(){e(t._id,u,c)}));var f=u.querySelector(".card__like-button");return f.addEventListener("click",(function(e){return n(e,a,i,t._id,s)})),l.addEventListener("click",(function(){return o(t.link,t.name)})),s.textContent=t.likes?t.likes.length:0,t.likes&&t.likes.some((function(t){return t._id===r}))&&f.classList.add("card__like-button_is-active"),u}var o=null;function r(t){"Escape"===t.key&&(a(o),o=null)}function c(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",r),o=t}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}var i=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)},u=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent="",n.setCustomValidity("")})),o.classList.add(e.inactiveButtonClass)},l=function(){return fetch("https://nomoreparties.co/v1/cohort-mag-4/users/me",{method:"GET",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1"}}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)}))},s=function(t){return fetch("https://nomoreparties.co/v1/cohort-mag-4/cards/".concat(t),{method:"DELETE",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1"}}).catch((function(t){console.log(t)}))},d=function(t){return fetch("https://nomoreparties.co/v1/cohort-mag-4/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1"}}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)}))},f=function(t){return fetch("https://nomoreparties.co/v1/cohort-mag-4/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1"}}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)}))};function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var m,h=document.querySelector(".places__list"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_edit"),_=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.forms["edit-profile"],g=document.forms["new-place"],k=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_avatar"),L=document.forms["edit-avatar"],x={},A={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function j(t,e){var n=document.querySelector(".popup_type_image");c(n),n.querySelector(".popup__image").src=t,n.querySelector(".popup__image").alt=e}document.querySelectorAll(".popup").forEach((function(t){t.classList.add("popup_is-animated")})),_.addEventListener("click",(function(){c(y),S.elements.name.value=k.textContent,S.elements.description.value=C.textContent,u(S,A)})),b.addEventListener("click",(function(){c(v),u(g,A)})),document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&a(t)}))})),S.addEventListener("submit",(function(t){var e,n;!function(t){t.preventDefault();var e=S.elements.name.value,n=S.elements.description.value;document.querySelector(".profile__title").textContent=e,document.querySelector(".profile__description").textContent=n,a(o)}(t),S.querySelector(".button").textContent="Сохранение...",(e=k.textContent,n=C.textContent,fetch("https://nomoreparties.co/v1/cohort-mag-4/users/me",{method:"PATCH",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1","Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)}))).then((function(){S.querySelector(".button").textContent="Сохранить"}))})),g.addEventListener("submit",(function(r){var c,i;S.querySelector(".button").textContent="Сохранение...",(c=g.elements["place-name"].value,i=g.elements.link.value,fetch("https://nomoreparties.co/v1/cohort-mag-4/cards",{method:"POST",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1","Content-Type":"application/json"},body:JSON.stringify({name:c,link:i})}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)}))).then((function(c){!function(r,c){r.preventDefault();var i=n({name:"".concat(c.name),link:"".concat(c.link),likes:"".concat(c.likes),_id:"".concat(c._id),owner:{_id:x._id}},t,e,j,x._id,s,d,f);h.prepend(i),g.reset(),a(o)}(r,c),S.querySelector(".button").textContent="Сохранить"}))})),m=A,Array.from(document.querySelectorAll(m.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);i(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),i(n,o,e)}))}))}(t,m)})),Promise.all([l(),fetch("https://nomoreparties.co/v1/cohort-mag-4/cards",{method:"GET",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1"}}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)}))]).then((function(o){var r,c,a=(c=2,function(t){if(Array.isArray(t))return t}(r=o)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(r,c)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(r,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];x=i,k.textContent=i.name,C.textContent=i.about,q.style.backgroundImage="url(".concat(i.avatar,")"),u.map((function(o){return n(o,t,e,j,i._id,s,d,f)})).forEach((function(t){h.append(t)}))})),q.addEventListener("click",(function(){c(E)})),L.addEventListener("submit",(function(t){var e;t.preventDefault(),L.querySelector(".button").textContent="Сохранение...",(e=L.elements["avatar-link"].value,fetch("https://nomoreparties.co/v1/cohort-mag-4/users/me/avatar",{method:"PATCH",headers:{authorization:"1aa131cc-2862-4b88-baa9-9f6d0e2456b1","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).catch((function(t){console.log(t)}))).then((function(){l().then((function(t){q.style.backgroundImage="url(".concat(t.avatar,")")}))})).then((function(){u(L,A),L.elements["avatar-link"].value="",a(E),L.querySelector(".button").textContent="Сохранить"}))}))})();